#!/usr/bin/bash
# Usage: ./init <gmail_address>
#
# Convenient script to initialize directory structure and generate signing key

SCRIPT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/../lib/guardrails.sh"
source "$SCRIPT_DIR/../lib/constants.sh"
source "$SCRIPT_DIR/../lib/parse.sh"
require_cmd openssl base64 gmi notmuch

# Also initialize notmuch and gmi config files
#notmuch setup --user-name="Secure Communication User" --user-email="$1"
#notmuch new
#gmi 

DANGER_USER_email="$1"

email=$(parse_email "$DANGER_USER_email")

mkdir -p "$MY_DIR"

echo "$email" > "$MY_DIR/$EMAIL"

"$SCRIPT_DIR/../generate_signing_key.sh"